<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byte Pair Encoding (BPE) Animation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }

        .step-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .corpus-display {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            min-height: 80px;
        }

        .token {
            background: #e7f3ff;
            border: 2px solid #90caf9;
            border-radius: 8px;
            padding: 8px 12px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .token.highlight {
            background: #ffd54f;
            border-color: #ffa000;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
        }

        .token.merging {
            animation: merge 0.6s ease;
        }

        .word-separator {
            color: #999;
            font-weight: bold;
            margin: 0 5px;
        }

        @keyframes merge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(5deg); background: #4caf50; }
            100% { transform: scale(1); }
        }

        .vocab-section {
            background: #fff3e0;
            border: 2px solid #ffb74d;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .vocab-title {
            font-weight: bold;
            color: #f57c00;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .vocab-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .vocab-item {
            background: white;
            border: 2px solid #ffb74d;
            border-radius: 6px;
            padding: 6px 12px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .vocab-item.new {
            animation: appear 0.5s ease;
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        @keyframes appear {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .merge-info {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .merge-info strong {
            color: #2e7d32;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .progress {
            text-align: center;
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
            margin-top: 20px;
        }

        .explanation {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            line-height: 1.6;
        }

        .pair-freq {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .pair-freq-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .freq-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .freq-item.top {
            background: #ffeb3b;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”¤ Byte Pair Encoding (BPE)</h1>
        <p class="subtitle">Sequential Tokenization Process</p>

        <div class="explanation">
            <strong>How BPE Works:</strong> Start with individual characters, count adjacent pairs, 
            merge the most frequent pair, and repeat! This builds a vocabulary of common word pieces.
        </div>

        <div id="stepsContainer"></div>
    </div>

    <script>
        const steps = [
            {
                title: "Step 0: Initial Corpus (Character Level)",
                corpus: [
                    ['l', 'o', 'w'], '|',
                    ['l', 'o', 'w', 'e', 'r'], '|',
                    ['l', 'o', 'w', 'e', 's', 't']
                ],
                vocab: ['l', 'o', 'w', 'e', 'r', 's', 't'],
                explanation: "Starting with individual characters. Each letter is a separate token.",
                pairs: { 'l+o': 3, 'o+w': 3, 'w+e': 2, 'e+r': 1, 'e+s': 1, 's+t': 1 },
                highlightPairs: []
            },
            {
                title: "Step 1: Merge 'l' + 'o' â†’ 'lo' (appears 3 times)",
                corpus: [
                    ['lo', 'w'], '|',
                    ['lo', 'w', 'e', 'r'], '|',
                    ['lo', 'w', 'e', 's', 't']
                ],
                vocab: ['l', 'o', 'w', 'e', 'r', 's', 't', 'lo'],
                newVocab: ['lo'],
                explanation: "The pair 'l+o' appears 3 times (in low, lower, lowest). Merge them into 'lo'!",
                pairs: { 'lo+w': 3, 'w+e': 2, 'e+r': 1, 'e+s': 1, 's+t': 1 },
                highlightPairs: [['l', 'o']]
            },
            {
                title: "Step 2: Merge 'lo' + 'w' â†’ 'low' (appears 3 times)",
                corpus: [
                    ['low'], '|',
                    ['low', 'e', 'r'], '|',
                    ['low', 'e', 's', 't']
                ],
                vocab: ['l', 'o', 'w', 'e', 'r', 's', 't', 'lo', 'low'],
                newVocab: ['low'],
                explanation: "Now 'lo+w' is most frequent (3 times). Merge them into 'low'!",
                pairs: { 'low+e': 2, 'e+r': 1, 'e+s': 1, 's+t': 1 },
                highlightPairs: [['lo', 'w']]
            },
            {
                title: "Step 3: Merge 'e' + 'r' â†’ 'er' (appears 1 time)",
                corpus: [
                    ['low'], '|',
                    ['low', 'er'], '|',
                    ['low', 'e', 's', 't']
                ],
                vocab: ['l', 'o', 'w', 'e', 'r', 's', 't', 'lo', 'low', 'er'],
                newVocab: ['er'],
                explanation: "We could merge 'low+e' (2 times) but choosing 'e+r' for this demo. Now 'lower' = 'low' + 'er'.",
                pairs: { 'low+e': 1, 'e+s': 1, 's+t': 1 },
                highlightPairs: [['e', 'r']]
            },
            {
                title: "Step 4: Final Tokenization âœ¨",
                corpus: [
                    ['low'], '|',
                    ['low', 'er'], '|',
                    ['low', 'e', 's', 't']
                ],
                vocab: ['l', 'o', 'w', 'e', 'r', 's', 't', 'lo', 'low', 'er'],
                explanation: "BPE complete! Final tokenization: 'low' â†’ ['low'], 'lower' â†’ ['low', 'er'], 'lowest' â†’ ['low', 'e', 's', 't']",
                pairs: {},
                highlightPairs: []
            }
        ];

        function createCorpusHTML(corpus, highlightPairs) {
            let html = '';
            
            corpus.forEach((word, wordIdx) => {
                if (word === '|') {
                    html += '<span class="word-separator">|</span>';
                } else {
                    word.forEach((token, tokenIdx) => {
                        let className = 'token';
                        
                        // Check if this token and next should be highlighted
                        if (tokenIdx < word.length - 1) {
                            for (let pair of highlightPairs) {
                                if (token === pair[0] && word[tokenIdx + 1] === pair[1]) {
                                    className += ' highlight';
                                }
                            }
                        }
                        
                        html += `<span class="${className}">${token}</span>`;
                    });
                }
            });
            
            return html;
        }

        function createVocabHTML(vocab, newVocab) {
            let html = '';
            
            vocab.forEach(item => {
                let className = 'vocab-item';
                if (newVocab && newVocab.includes(item)) {
                    className += ' new';
                }
                html += `<span class="${className}">"${item}"</span>`;
            });
            
            return html;
        }

        function createPairFreqHTML(pairs) {
            if (Object.keys(pairs).length === 0) return '';
            
            const sortedPairs = Object.entries(pairs).sort((a, b) => b[1] - a[1]);
            let html = '<div class="pair-freq"><div class="pair-freq-title">ðŸ“Š Pair Frequencies:</div><div>';
            
            sortedPairs.forEach(([pair, freq], idx) => {
                const className = idx === 0 ? 'freq-item top' : 'freq-item';
                html += `<span class="${className}">${pair}: ${freq}</span>`;
            });
            
            html += '</div></div>';
            return html;
        }

        function renderAllSteps() {
            const container = document.getElementById('stepsContainer');
            
            steps.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.style.marginBottom = '40px';
                
                let html = `
                    <div class="step-header">${step.title}</div>
                    <div class="merge-info">
                        <strong>What's happening:</strong> ${step.explanation}
                    </div>
                    ${createPairFreqHTML(step.pairs)}
                    <div class="corpus-display">
                        ${createCorpusHTML(step.corpus, step.highlightPairs || [])}
                    </div>
                    <div class="vocab-section">
                        <div class="vocab-title">ðŸ“š Vocabulary (${step.vocab.length} tokens):</div>
                        <div class="vocab-list">
                            ${createVocabHTML(step.vocab, step.newVocab)}
                        </div>
                    </div>
                `;
                
                // Add arrow between steps
                if (index < steps.length - 1) {
                    html += `
                        <div style="text-align: center; margin: 20px 0; font-size: 2em; color: #667eea;">
                            â†“
                        </div>
                    `;
                }
                
                stepDiv.innerHTML = html;
                container.appendChild(stepDiv);
            });
        }

        // Render all steps on page load
        renderAllSteps();
    </script>
</body>
</html>