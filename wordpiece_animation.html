<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPiece Tokenization Animation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: #1a1a1a;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255,255,255,0.1);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            border: 1px solid #333;
        }

        h1 {
            color: #f59e0b;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #9ca3af;
            margin-bottom: 30px;
            font-style: italic;
        }

        .step-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .corpus-display {
            background: #2d2d2d;
            border: 2px solid #404040;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            min-height: 80px;
        }

        .token {
            background: #374151;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 8px 12px;
            display: inline-block;
            transition: all 0.3s ease;
            color: #e5e7eb;
        }

        .token.highlight {
            background: #fbbf24;
            border-color: #f59e0b;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
            color: #000;
        }

        .token.merging {
            animation: merge 0.6s ease;
        }

        .token.continuation {
            background: #4b3d2a;
            border-color: #fb923c;
            color: #fed7aa;
        }

        .word-separator {
            color: #6b7280;
            font-weight: bold;
            margin: 0 5px;
        }

        @keyframes merge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(5deg); background: #4caf50; }
            100% { transform: scale(1); }
        }

        .vocab-section {
            background: #2d2d2d;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .vocab-title {
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .vocab-subsection {
            margin-bottom: 15px;
        }

        .vocab-subsection-title {
            font-size: 0.9em;
            color: #9ca3af;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .vocab-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .vocab-item {
            background: #374151;
            border: 2px solid #f59e0b;
            border-radius: 6px;
            padding: 6px 12px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #e5e7eb;
        }

        .vocab-item.base {
            background: #1e3a5f;
            border-color: #60a5fa;
            color: #93c5fd;
        }

        .vocab-item.learned {
            background: #4a2c0a;
            border-color: #fb923c;
            color: #fed7aa;
        }

        .vocab-item.new {
            animation: appear 0.5s ease;
            background: #d97706;
            color: white;
            border-color: #f59e0b;
        }

        @keyframes appear {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .merge-info {
            background: #2d1e0f;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            color: #fed7aa;
        }

        .merge-info strong {
            color: #fbbf24;
        }

        .explanation {
            background: #2d1b3d;
            border-left: 4px solid #a855f7;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            line-height: 1.6;
            color: #e9d5ff;
        }

        .likelihood-display {
            background: #2d2d2d;
            border: 2px solid #4b5563;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .likelihood-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #d1d5db;
        }

        .likelihood-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            background: #374151;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            color: #e5e7eb;
        }

        .likelihood-item.top {
            background: #fbbf24;
            font-weight: bold;
            color: #000;
        }

        .difference-box {
            background: linear-gradient(135deg, #7c2d12 0%, #991b1b 100%);
            border: 2px solid #dc2626;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            color: #fecaca;
        }

        .difference-box h3 {
            color: #fca5a5;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .difference-box ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .difference-box strong {
            color: #fee2e2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî∂ WordPiece Tokenization</h1>
        <p class="subtitle">Likelihood-Based Sequential Process</p>

        <div class="explanation">
            <strong>How WordPiece Works:</strong> Unlike BPE (frequency-based), WordPiece uses likelihood to select merges. It also uses "##" prefix for continuation tokens (subwords that don't start a word).
        </div>

        <div class="difference-box">
            <h3>üîÑ Key Differences from BPE:</h3>
            <ul>
                <li><strong>Merging Criterion:</strong> WordPiece uses likelihood/probability (which pair increases vocabulary likelihood the most?) vs BPE uses simple frequency counts</li>
                <li><strong>Continuation Marking:</strong> WordPiece adds "##" prefix to non-initial subwords (e.g., "##ing", "##er")</li>
                <li><strong>Tokenization Direction:</strong> WordPiece greedily matches longest token first from vocabulary</li>
                <li><strong>Usage:</strong> WordPiece is used by BERT, while BPE is used by GPT models</li>
            </ul>
        </div>

        <div id="stepsContainer"></div>

        <div style="margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #d97706 0%, #b45309 100%); border-radius: 15px; color: white; border: 2px solid #f59e0b;">
            <h2 style="margin-bottom: 20px; font-size: 2em;">üéØ FINAL RESULT: What Tokens Did We Produce?</h2>
            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                <div style="font-size: 1.3em; margin-bottom: 10px;"><strong>Original Word ‚Üí Final Tokens:</strong></div>
                <div style="font-size: 1.5em; font-family: 'Courier New', monospace; line-height: 2;">
                    <div>üìå <strong>"playing"</strong> ‚Üí [<span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px;">play</span>, <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px;">##ing</span>]</div>
                    <div>üìå <strong>"player"</strong> ‚Üí [<span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px;">play</span>, <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px;">##er</span>]</div>
                    <div>üìå <strong>"played"</strong> ‚Üí [<span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px;">play</span>, <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px;">##ed</span>]</div>
                </div>
            </div>
            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px;">
                <div style="font-size: 1.3em; margin-bottom: 10px;"><strong>Learned Vocabulary (15 tokens):</strong></div>
                <div style="font-size: 1.2em; font-family: 'Courier New', monospace;">
                    Original 9: "p", "l", "a", "y", "i", "n", "g", "e", "r", "d"<br>
                    <strong style="color: #ffeb3b;">+ Learned 5: "play", "##ing", "##er", "##ed", "##ay"</strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        const steps = [
            {
                step: "START",
                title: "üîµ WHAT HAPPENS FIRST: We Begin With Our Corpus",
                corpus: [
                    ['p', 'l', 'a', 'y', 'i', 'n', 'g'], '|',
                    ['p', 'l', 'a', 'y', 'e', 'r'], '|',
                    ['p', 'l', 'a', 'y', 'e', 'd']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd'],
                explanation: "We have three words: 'playing', 'player', 'played'. Split them into individual characters.",
                likelihoods: {
                    'p+l': 0.85,
                    'l+a': 0.92,
                    'a+y': 0.88,
                    'y+i': 0.45,
                    'i+n': 0.62,
                    'n+g': 0.58,
                    'y+e': 0.71,
                    'e+r': 0.55,
                    'e+d': 0.48
                },
                highlightPairs: [],
                action: "‚úÖ Initial vocabulary: 10 unique characters. Now we calculate likelihood scores for all adjacent pairs."
            },
            {
                step: "THEN",
                title: "üü¢ WHAT HAPPENS NEXT: First Merge (Highest Likelihood)",
                corpus: [
                    ['p', 'la', 'y', 'i', 'n', 'g'], '|',
                    ['p', 'la', 'y', 'e', 'r'], '|',
                    ['p', 'la', 'y', 'e', 'd']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la'],
                newVocab: ['la'],
                explanation: "Calculate likelihood for all pairs. 'l+a' has highest likelihood (0.92). Merge 'l' and 'a' into 'la'.",
                likelihoods: {
                    'p+la': 0.87,
                    'la+y': 0.94,
                    'y+i': 0.45,
                    'i+n': 0.62,
                    'n+g': 0.58,
                    'y+e': 0.71,
                    'e+r': 0.55,
                    'e+d': 0.48
                },
                highlightPairs: [['l', 'a']],
                action: "‚úÖ Add 'la' to vocabulary. Replace all 'l a' with 'la' in corpus."
            },
            {
                step: "THEN",
                title: "üü¢ WHAT HAPPENS NEXT: Second Merge",
                corpus: [
                    ['p', 'lay', 'i', 'n', 'g'], '|',
                    ['p', 'lay', 'e', 'r'], '|',
                    ['p', 'lay', 'e', 'd']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la', 'lay'],
                newVocab: ['lay'],
                explanation: "Recalculate likelihoods. 'la+y' has highest likelihood (0.94). Merge 'la' and 'y' into 'lay'.",
                likelihoods: {
                    'p+lay': 0.89,
                    'lay+i': 0.52,
                    'i+n': 0.62,
                    'n+g': 0.58,
                    'lay+e': 0.76,
                    'e+r': 0.55,
                    'e+d': 0.48
                },
                highlightPairs: [['la', 'y']],
                action: "‚úÖ Add 'lay' to vocabulary. Replace all 'la y' with 'lay' in corpus."
            },
            {
                step: "THEN",
                title: "üü¢ WHAT HAPPENS NEXT: Third Merge - Create Root Word",
                corpus: [
                    ['play', 'i', 'n', 'g'], '|',
                    ['play', 'e', 'r'], '|',
                    ['play', 'e', 'd']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la', 'lay', 'play'],
                newVocab: ['play'],
                explanation: "Recalculate likelihoods. 'p+lay' has highest likelihood (0.89). Merge 'p' and 'lay' into 'play'.",
                likelihoods: {
                    'play+i': 0.78,
                    'i+n': 0.62,
                    'n+g': 0.58,
                    'play+e': 0.82,
                    'e+r': 0.55,
                    'e+d': 0.48
                },
                highlightPairs: [['p', 'lay']],
                action: "‚úÖ Add 'play' to vocabulary. This becomes our root word! Replace all 'p lay' with 'play'."
            },
            {
                step: "THEN",
                title: "üü† WHAT HAPPENS NEXT: Fourth Merge - First Continuation Token",
                corpus: [
                    ['play', '##ing'], '|',
                    ['play', 'e', 'r'], '|',
                    ['play', 'e', 'd']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la', 'lay', 'play', '##ing'],
                newVocab: ['##ing'],
                explanation: "Now we look at continuations (non-initial subwords). 'i+n+g' appears after 'play'. Merge into '##ing' (## prefix indicates continuation).",
                likelihoods: {
                    'play+##ing': 0.95,
                    'play+e': 0.82,
                    'e+r': 0.55,
                    'e+d': 0.48
                },
                highlightPairs: [['i', 'n', 'g']],
                action: "‚úÖ Add '##ing' to vocabulary. The ## prefix marks this as a continuation token (not word-initial)."
            },
            {
                step: "THEN",
                title: "üü† WHAT HAPPENS NEXT: Fifth Merge - Second Continuation Token",
                corpus: [
                    ['play', '##ing'], '|',
                    ['play', '##er'], '|',
                    ['play', 'e', 'd']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la', 'lay', 'play', '##ing', '##er'],
                newVocab: ['##er'],
                explanation: "Merge 'e+r' into '##er' (continuation token for suffix).",
                likelihoods: {
                    'play+##ing': 0.95,
                    'play+##er': 0.91,
                    'play+e': 0.82,
                    'e+d': 0.48
                },
                highlightPairs: [['e', 'r']],
                action: "‚úÖ Add '##er' to vocabulary. Another continuation token for the suffix '-er'."
            },
            {
                step: "THEN",
                title: "üü† WHAT HAPPENS NEXT: Sixth Merge - Third Continuation Token",
                corpus: [
                    ['play', '##ing'], '|',
                    ['play', '##er'], '|',
                    ['play', '##ed']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la', 'lay', 'play', '##ing', '##er', '##ed'],
                newVocab: ['##ed'],
                explanation: "Merge 'e+d' into '##ed' (continuation token for past tense suffix).",
                likelihoods: {},
                highlightPairs: [['e', 'd']],
                action: "‚úÖ Add '##ed' to vocabulary. Continuation token for past tense suffix '-ed'."
            },
            {
                step: "FINALLY",
                title: "üî¥ WHAT HAPPENS FINALLY: Training Complete",
                corpus: [
                    ['play', '##ing'], '|',
                    ['play', '##er'], '|',
                    ['play', '##ed']
                ],
                vocab: ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd', 'la', 'lay', 'play', '##ing', '##er', '##ed'],
                explanation: "Training complete! Notice how WordPiece created: (1) A root word 'play', (2) Continuation tokens with ## prefix for suffixes. This structure helps the model understand word composition and morphology.",
                likelihoods: {},
                highlightPairs: [],
                action: "‚úÖ Final vocabulary: 16 tokens total. We learned 6 merged tokens including root words and continuation markers. The ## prefix helps distinguish word-initial vs word-internal subwords."
            }
        ];

        function createCorpusHTML(corpus, highlightPairs) {
            let html = '';
            
            corpus.forEach((word, wordIdx) => {
                if (word === '|') {
                    html += '<span class="word-separator">|</span>';
                } else {
                    word.forEach((token, tokenIdx) => {
                        let className = 'token';
                        
                        // Mark continuation tokens
                        if (token.startsWith('##')) {
                            className += ' continuation';
                        }
                        
                        // Check if this token should be highlighted
                        for (let pair of highlightPairs) {
                            if (pair.length === 2 && token === pair[0]) {
                                if (tokenIdx < word.length - 1 && word[tokenIdx + 1] === pair[1]) {
                                    className += ' highlight';
                                }
                            } else if (pair.length === 3 && token === pair[0]) {
                                if (tokenIdx < word.length - 2 && 
                                    word[tokenIdx + 1] === pair[1] && 
                                    word[tokenIdx + 2] === pair[2]) {
                                    className += ' highlight';
                                }
                            } else if (pair.includes(token)) {
                                className += ' highlight';
                            }
                        }
                        
                        html += `<span class="${className}">${token}</span>`;
                    });
                }
            });
            
            return html;
        }

        function createVocabHTML(vocab, newVocab, step) {
            const baseTokens = ['p', 'l', 'a', 'y', 'i', 'n', 'g', 'e', 'r', 'd'];
            const learnedTokens = vocab.filter(item => !baseTokens.includes(item));
            
            let html = '<div class="vocab-subsection">';
            html += '<div class="vocab-subsection-title">Base Tokens (characters):</div>';
            html += '<div class="vocab-list">';
            
            baseTokens.forEach(item => {
                html += `<span class="vocab-item base">"${item}"</span>`;
            });
            
            html += '</div></div>';
            
            if (learnedTokens.length > 0) {
                html += '<div class="vocab-subsection">';
                html += '<div class="vocab-subsection-title">Learned Tokens (merges with ## for continuations):</div>';
                html += '<div class="vocab-list">';
                
                learnedTokens.forEach(item => {
                    let className = 'vocab-item learned';
                    if (newVocab && newVocab.includes(item)) {
                        className = 'vocab-item new';
                    }
                    html += `<span class="${className}">"${item}"</span>`;
                });
                
                html += '</div></div>';
            }
            
            return html;
        }

        function createLikelihoodHTML(likelihoods) {
            if (Object.keys(likelihoods).length === 0) return '';
            
            const sortedLikelihoods = Object.entries(likelihoods).sort((a, b) => b[1] - a[1]);
            let html = '<div class="likelihood-display"><div class="likelihood-title">üìä Likelihood Scores (higher = better merge candidate):</div><div>';
            
            sortedLikelihoods.forEach(([pair, score], idx) => {
                const className = idx === 0 ? 'likelihood-item top' : 'likelihood-item';
                html += `<span class="${className}">${pair}: ${score.toFixed(2)}</span>`;
            });
            
            html += '</div></div>';
            return html;
        }

        function renderAllSteps() {
            const container = document.getElementById('stepsContainer');
            
            steps.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.style.marginBottom = '40px';
                
                let html = `
                    <div class="step-header">${step.title}</div>
                    <div class="merge-info">
                        <strong>${step.step}:</strong> ${step.explanation}
                    </div>
                    <div style="background: #2d1e0f; border-left: 4px solid #f59e0b; padding: 15px; margin-bottom: 20px; border-radius: 5px; color: #fed7aa;">
                        <strong style="color: #fbbf24;">Action taken:</strong> ${step.action}
                    </div>
                    ${createLikelihoodHTML(step.likelihoods)}
                    <div class="corpus-display">
                        ${createCorpusHTML(step.corpus, step.highlightPairs || [])}
                    </div>
                    <div class="vocab-section">
                        <div class="vocab-title">üìö Vocabulary (${step.vocab.length} tokens total):</div>
                        ${createVocabHTML(step.vocab, step.newVocab, step.step)}
                    </div>
                `;
                
                // Add arrow between steps
                if (index < steps.length - 1) {
                    html += `
                        <div style="text-align: center; margin: 30px 0; font-size: 3em; color: #f59e0b;">
                            ‚¨áÔ∏è
                        </div>
                    `;
                }
                
                stepDiv.innerHTML = html;
                container.appendChild(stepDiv);
            });
        }

        // Render all steps on page load
        renderAllSteps();
    </script>
</body>
</html